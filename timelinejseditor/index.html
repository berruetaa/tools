<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de JSON Complejo version 1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: auto;
        }
        .field {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        textarea {
            height: 120px;
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .event-group {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        .remove-event {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #dc3545;
        }
        .remove-event:hover {
            background-color: #c82333;
        }
        .add-event {
            margin-bottom: 20px;
        }
        .btn-container {
            margin-top: 20px;
        }
        #fileInput {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Editor de JSON Complejo</h1>

        <!-- Cargar JSON -->
        <input type="file" id="fileInput" accept=".json" onchange="loadJSON(event)">

        <form id="jsonForm">
            <h2>Título</h2>
            <div class="field">
                <label for="title-headline">Titular del Título</label>
                <input type="text" id="title-headline" name="title-headline" value="">
            </div>
            <div class="field">
                <label for="title-text">Texto del Título</label>
                <textarea id="title-text" name="title-text" placeholder="Ingrese el texto aquí..."></textarea>
            </div>

            <h2>Eventos</h2>
            <div class="add-event">
                <button type="button" onclick="addEvent()">+ Agregar Evento</button>
            </div>
            <div id="events-container">
                <!-- Eventos se agregarán aquí -->
            </div>

            <button type="button" onclick="generateJSON()">Generar JSON</button>
        </form>

        <h2>JSON Resultante</h2>
        <pre id="jsonOutput"></pre>

        <div class="btn-container">
            <input type="text" id="fileName" placeholder="Nombre del archivo" value="nombre.json">
            <button type="button" onclick="downloadJSON()">Descargar JSON</button>
            <button type="button" onclick="copyToClipboard()">Copiar al portapapeles</button>
        </div>
    </div>

    <script>
        let eventCount = 0;

        function addEvent() {
            const container = document.getElementById('events-container');
            const index = eventCount++;
            const eventDiv = document.createElement('div');
            eventDiv.classList.add('event-group');
            eventDiv.id = `event-${index}`;
            eventDiv.innerHTML = `
                <button type="button" class="remove-event" onclick="removeEvent(${index})">Eliminar</button>
                <h3>Evento ${index + 1}</h3>
                <div class="field">
                    <label for="event-media-url-${index}">URL de la Imagen</label>
                    <input type="text" id="event-media-url-${index}" name="event-media-url-${index}" value="">
                </div>
                <div class="field">
                    <label for="event-media-caption-${index}">Texto de la Imagen</label>
                    <input type="text" id="event-media-caption-${index}" name="event-media-caption-${index}" value="">
                </div>
                <div class="field">
                    <label for="event-media-credit-${index}">Crédito de la Imagen</label>
                    <input type="text" id="event-media-credit-${index}" name="event-media-credit-${index}" value="">
                </div>
                <div class="field">
                    <label for="event-start_date-year-${index}">Año de Inicio</label>
                    <input type="text" id="event-start_date-year-${index}" name="event-start_date-year-${index}" value="">
                </div>
                <div class="field">
                    <label for="event-text-headline-${index}">Titular</label>
                    <input type="text" id="event-text-headline-${index}" name="event-text-headline-${index}" value="">
                </div>
                <div class="field">
                    <label for="event-text-content-${index}">Contenido del Texto</label>
                    <textarea id="event-text-content-${index}" name="event-text-content-${index}" placeholder="Ingrese el contenido del texto aquí..."></textarea>
                </div>
                <div class="field">
                    <label for="event-text-source-url-${index}">URL de la Fuente</label>
                    <input type="text" id="event-text-source-url-${index}" name="event-text-source-url-${index}" value="">
                </div>
                <div class="field">
                    <label for="event-text-source-text-${index}">Texto de la Fuente</label>
                    <input type="text" id="event-text-source-text-${index}" name="event-text-source-text-${index}" value="">
                </div>
            `;
            container.appendChild(eventDiv);
        }

        function removeEvent(index) {
    const eventDiv = document.getElementById(`event-${index}`);
    if (eventDiv) {
        eventDiv.remove();

        // Actualizar el contador de eventos
        eventCount--;

        // Reordenar los eventos restantes
        const eventsContainer = document.getElementById('events-container');
        const events = Array.from(eventsContainer.children); // Convertir NodeList a array

        // Iterar en orden inverso para mantener la indexación correcta
        for (let i = events.length - 1; i >= index; i--) {
            const currentEvent = events[i];
            const newIndex = i - 1; // Nueva indexación después de eliminar

            // Actualizar el ID del evento
            currentEvent.id = `event-${newIndex}`;

            // Actualizar los IDs y nombres de los inputs y textareas
            const inputs = currentEvent.getElementsByTagName('input');
            for (let input of inputs) {
                input.id = input.id.replace(/\d+$/, newIndex);
                input.name = input.name.replace(/\d+$/, newIndex);
            }
            const textareas = currentEvent.getElementsByTagName('textarea');
            for (let textarea of textareas) {
                textarea.id = textarea.id.replace(/\d+$/, newIndex);
                textarea.name = textarea.name.replace(/\d+$/, newIndex);
            }
        }
    }
}


        function generateJSON() {
            const json = {
                title: {
                    media: {
                        url: "",
                        caption: "",
                        credit: ""
                    },
                    text: {
                        headline: document.getElementById('title-headline').value,
                        text: `<p>${document.getElementById('title-text').value}</p>`
                    }
                },
                events: Array.from({ length: eventCount }).map((_, index) => ({
                    media: {
                        url: document.getElementById(`event-media-url-${index}`).value,
                        caption: document.getElementById(`event-media-caption-${index}`).value,
                        credit: document.getElementById(`event-media-credit-${index}`).value
                    },
                    start_date: {
                        year: document.getElementById(`event-start_date-year-${index}`).value
                    },
                    text: {
                        headline: document.getElementById(`event-text-headline-${index}`).value,
                        text: `<p>${document.getElementById(`event-text-content-${index}`).value}</p> <small><i>Fuente: <a href="${document.getElementById(`event-text-source-url-${index}`).value}" target="_blank">${document.getElementById(`event-text-source-text-${index}`).value}</a></i></small>`
                    }
                }))
            };
            const jsonString = JSON.stringify(json, null, 2);
            document.getElementById('jsonOutput').textContent = jsonString;
        }

        function downloadJSON() {
            const jsonString = document.getElementById('jsonOutput').textContent;
            const fileName = document.getElementById('fileName').value || 'nombre.json';
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
            const jsonString = document.getElementById('jsonOutput').textContent;
            navigator.clipboard.writeText(jsonString).then(() => {
                alert('JSON copiado al portapapeles');
            });
        }

        function loadJSON(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = JSON.parse(e.target.result);
                    populateForm(data);
                };
                reader.readAsText(file);
            }
        }

        function populateForm(data) {
            // Limpiar eventos existentes
            document.getElementById('events-container').innerHTML = '';
            eventCount = 0;

            if (data.title) {
                document.getElementById('title-headline').value = data.title.text.headline || '';
                document.getElementById('title-text').value = data.title.text.text.replace(/<\/?p>/g, '').trim() || '';
            }

            if (data.events) {
                data.events.forEach((event, index) => {
                    addEvent(); // Agrega un nuevo evento
                    const eventDiv = document.getElementById(`event-${index}`);
                    document.getElementById(`event-media-url-${index}`).value = event.media.url || '';
                    document.getElementById(`event-media-caption-${index}`).value = event.media.caption || '';
                    document.getElementById(`event-media-credit-${index}`).value = event.media.credit || '';
                    document.getElementById(`event-start_date-year-${index}`).value = event.start_date.year || '';
                    document.getElementById(`event-text-headline-${index}`).value = event.text.headline || '';

                    // Extrae el contenido y la fuente del texto
                    const textContent = event.text.text.match(/<p>(.*?)<\/p>/);
                    const textSource = event.text.text.match(/<small><i>Fuente: <a href="(.*?)" target="_blank">(.*?)<\/a><\/i><\/small>/);

                    document.getElementById(`event-text-content-${index}`).value = textContent ? textContent[1] : '';
                    document.getElementById(`event-text-source-url-${index}`).value = textSource ? textSource[1] : '';
                    document.getElementById(`event-text-source-text-${index}`).value = textSource ? textSource[2] : '';
                });
            }
        }
    </script>
</body>
</html>
